# This is a GitHub Actions workflow to run an omikuji bot and send the result to ChatWork.

name: Omikuji Bot

on:
  workflow_dispatch:

jobs:
  draw_fortune:
    runs-on: ubuntu-latest
    steps:
      - name: Install bc
        run: sudo apt-get update && sudo apt-get install bc -y

      - name: Draw a normal fortune
        id: normal_fortune
        run: |
          #!/bin/bash
          fortunes=("大吉" "中吉" "小吉" "吉" "末吉" "凶" "大凶" "平" "🌱" "超大吉")
          probabilities=(5 20 20 15 15 10 10 4 0.01 0.01)
          messages=("やったー！最高の運勢です。" "何かいいことがあるかもしれません。" "まあまあ良い運勢です。" "普通の一日になりそう。" "ぼちぼちです。" "気をつけて過ごしましょう。" "今日は静かに過ごしましょう。" "変化はないが、穏やかな一日。" "あなたの努力が芽吹く日です。" "奇跡が起こるかも？！")

          RANDOM_NUMBER=$(echo "scale=2; 100 * $RANDOM / 32767" | bc)
          fortune_index=-1
          
          CUMULATIVE_PROB=0
          for i in "${!fortunes[@]}"; do
            CUMULATIVE_PROB=$(echo "$CUMULATIVE_PROB + ${probabilities[$i]}" | bc)
            if [ $(echo "$RANDOM_NUMBER <= $CUMULATIVE_PROB" | bc -l) -eq 1 ]; then
              fortune_index=$i
              break
            fi
          done

          echo "FORTUNE=${fortunes[$fortune_index]}" >> $GITHUB_ENV
          echo "MESSAGE=${messages[$fortune_index]}" >> $GITHUB_ENV

      - name: Send message to ChatWork
        run: |
          #!/bin/bash
          MESSAGE="【おみくじの結果】\n結果: ${{ env.FORTUNE }}\n一言: ${{ env.MESSAGE }}"
          curl -s -X POST \
          -H "X-ChatWorkToken: ${{ secrets.CHATWORK_TOKEN }}" \
          -d "body=${MESSAGE}" \
          "https://api.chatwork.com/v2/rooms/${{ secrets.CHATWORK_ROOM_ID }}/messages"


このコードなら、外部の依存関係に左右されることなく、確実に動作するはずです。

もし、この新しいコードでも問題が発生した場合は、GitHubの**「Actions」**タブに表示される**エラーメッセージの全文**を教えていただけますか？
